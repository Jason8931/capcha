<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .captcha-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            padding: 24px;
            text-align: center;
        }

        .logo {
            margin-bottom: 20px;
        }

        h1 {
            font-size: 22px;
            font-weight: 400;
            margin-bottom: 16px;
            color: #202124;
        }

        .description {
            color: #5f6368;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 24px;
        }

        .camera-container {
            position: relative;
            width: 100%;
            height: 300px;
            background-color: #f1f3f4;
            border-radius: 4px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            pointer-events: none;
        }

        .grid-cell {
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.2s;
            pointer-events: auto;
            cursor: pointer;
        }

        .grid-cell.selected {
            border: 2px solid #1a73e8;
            box-shadow: 0 0 0 2px #1a73e8 inset;
        }

        .permission-btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 24px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-bottom: 16px;
            width: 100%;
        }

        .permission-btn:hover {
            background-color: #1669d6;
        }

        .permission-btn:disabled {
            background-color: #dadce0;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .camera-select {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }

        .verify-btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 24px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
            display: none;
        }

        .verify-btn:hover {
            background-color: #1669d6;
        }

        .footer {
            margin-top: 16px;
            font-size: 12px;
            color: #5f6368;
        }

        .success-message {
            color: #0f9d58;
            font-size: 14px;
            margin-top: 16px;
            display: none;
        }

        .error-message {
            color: #d93025;
            font-size: 14px;
            margin-top: 16px;
            display: none;
        }

        .camera-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            color: #5f6368;
            font-size: 48px;
            flex-direction: column;
        }

        .retry-btn {
            background-color: #f1f3f4;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            display: none;
        }

        .loading {
            color: #5f6368;
            font-size: 14px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>

<body>
    <div class="captcha-container">
        <div class="logo">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M20 0C8.954 0 0 8.954 0 20C0 31.046 8.954 40 20 40C31.046 40 40 31.046 40 20C40 8.954 31.046 0 20 0Z"
                    fill="#4285F4" />
                <path
                    d="M20 8C13.373 8 8 13.373 8 20C8 26.627 13.373 32 20 32C26.627 32 32 26.627 32 20C32 13.373 26.627 8 20 8Z"
                    fill="white" />
                <path
                    d="M20 12C15.582 12 12 15.582 12 20C12 24.418 15.582 28 20 28C24.418 28 28 24.418 28 20C28 15.582 24.418 12 20 12Z"
                    fill="#34A853" />
                <path
                    d="M20 16C17.791 16 16 17.791 16 20C16 22.209 17.791 24 20 24C22.209 24 24 22.209 24 20C24 17.791 22.209 16 20 16Z"
                    fill="#FBBC04" />
                <path
                    d="M20 20C20 17.791 21.791 16 24 16C26.209 16 28 17.791 28 20C28 22.209 26.209 24 24 24C21.791 24 20 22.209 20 20Z"
                    fill="#EA4335" />
            </svg>
        </div>

        <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h1>

        <div class="description">
            –í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω <strong>–î–æ–ª–±–∞—ë–±</strong>
        </div>

        <div class="camera-container">
            <div class="camera-placeholder" id="cameraPlaceholder">
                üì∑
                <div class="loading" id="loadingMessage">–ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞–º–µ—Ä...</div>
            </div>
            <video id="video" autoplay playsinline></video>
            <div class="grid-overlay" id="gridOverlay"></div>
        </div>

        <select class="camera-select" id="cameraSelect">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ—Ä—É...</option>
        </select>

        <button class="permission-btn" id="permissionBtn">–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</button>
        <button class="retry-btn" id="retryBtn">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞–º–µ—Ä—É</button>

        <button class="verify-btn" id="verifyBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>

        <div class="success-message" id="successMessage">
            –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
        </div>

        <div class="error-message" id="errorMessage">
            –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.
        </div>

        <div class="footer">
            –ó–∞—â–∏—â–µ–Ω–æ reCAPTCHA<br>
            <a href="#" style="color: #1a73e8;">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a> ‚Ä¢
            <a href="#" style="color: #1a73e8;">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const permissionBtn = document.getElementById('permissionBtn');
            const verifyBtn = document.getElementById('verifyBtn');
            const video = document.getElementById('video');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const cameraPlaceholder = document.getElementById('cameraPlaceholder');
            const gridOverlay = document.getElementById('gridOverlay');
            const cameraSelect = document.getElementById('cameraSelect');
            const retryBtn = document.getElementById('retryBtn');
            const loadingMessage = document.getElementById('loadingMessage');

            let currentStream = null;
            let cameras = [];

            // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É 3x3
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.dataset.index = i;
                gridOverlay.appendChild(cell);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ —Å–µ—Ç–∫–∏
            gridOverlay.addEventListener('click', function (e) {
                if (e.target.classList.contains('grid-cell')) {
                    e.target.classList.toggle('selected');

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —è—á–µ–π–∫–∞
                    const selectedCells = document.querySelectorAll('.grid-cell.selected');
                    if (selectedCells.length > 0) {
                        verifyBtn.style.display = 'block';
                    } else {
                        verifyBtn.style.display = 'none';
                    }
                }
            });

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞–º–µ—Ä
            async function getCameras() {
                try {
                    loadingMessage.style.display = 'block';
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    const videoDevices = devices.filter(device => device.kind === 'videoinput');

                    cameraSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ—Ä—É...</option>';

                    if (videoDevices.length === 0) {
                        cameraSelect.innerHTML = '<option value="">–ö–∞–º–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>';
                        return [];
                    }

                    videoDevices.forEach((device, index) => {
                        const label = device.label || `–ö–∞–º–µ—Ä–∞ ${index + 1}`;
                        const option = document.createElement('option');
                        option.value = device.deviceId;
                        option.text = label;
                        cameraSelect.appendChild(option);
                    });

                    loadingMessage.style.display = 'none';
                    return videoDevices;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞–º–µ—Ä:', error);
                    loadingMessage.style.display = 'none';
                    return [];
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã
            async function startCamera(deviceId = null) {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ç–æ–∫
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }

                const constraints = {
                    video: {
                        deviceId: deviceId ? { exact: deviceId } : undefined,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };

                try {
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    currentStream = stream;

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã
                    video.srcObject = stream;
                    cameraPlaceholder.style.display = 'none';

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–∞–º–µ—Ä—ã
                    retryBtn.style.display = 'block';

                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                    errorMessage.style.display = 'none';

                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);

                    // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–∞–º–µ—Ä—É, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
                    if (cameras.length > 0) {
                        const currentIndex = cameras.findIndex(cam =>
                            deviceId ? cam.deviceId === deviceId : false);

                        if (currentIndex !== -1 && currentIndex < cameras.length - 1) {
                            const nextCamera = cameras[currentIndex + 1];
                            return await startCamera(nextCamera.deviceId);
                        }
                    }

                    // –ï—Å–ª–∏ –≤—Å–µ –∫–∞–º–µ—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    errorMessage.style.display = 'block';
                    cameraPlaceholder.style.display = 'flex';
                    return false;
                }
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
            permissionBtn.addEventListener('click', async function () {
                try {
                    // –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
                    await navigator.mediaDevices.getUserMedia({ video: true });

                    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä
                    cameras = await getCameras();

                    if (cameras.length > 0) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∫–∞–º–µ—Ä—ã
                        cameraSelect.style.display = 'block';
                        permissionBtn.style.display = 'none';

                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—É—é –∫–∞–º–µ—Ä—É
                        if (cameras.length === 1) {
                            await startCamera(cameras[0].deviceId);
                        }
                    } else {
                        errorMessage.textContent = '–ö–∞–º–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ';
                        errorMessage.style.display = 'block';
                    }
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', err);
                    errorMessage.style.display = 'block';
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–∞–º–µ—Ä—ã
            cameraSelect.addEventListener('change', async function () {
                if (cameraSelect.value) {
                    await startCamera(cameraSelect.value);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
            retryBtn.addEventListener('click', function () {
                cameraSelect.style.display = 'block';
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            verifyBtn.addEventListener('click', function () {
                // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                verifyBtn.disabled = true;
                verifyBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';

                setTimeout(function () {
                    successMessage.style.display = 'block';
                    verifyBtn.style.display = 'none';
                    retryBtn.style.display = 'none';

                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ –∫–∞–º–µ—Ä—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
                    if (currentStream) {
                        currentStream.getTracks().forEach(track => track.stop());
                    }
                }, 1500);
            });
        });
    </script>
</body>

</html>